# Подкидной дурак (браузерная версия)

В репозитории лежит минимальный сервер FastAPI и статический фронтенд, который позволяет играть в подкидного дурака по приглашениям. Комнаты приватные: чтобы зайти, нужно знать ссылку или буквенно-цифровой код (6 символов). Создатель задаёт лимит игроков (от 2 до 6), приглашает друзей и запускает партию.

## Как запустить

1. Убедитесь, что установлен Python 3.11+.
2. (Опционально) создайте и активируйте виртуальное окружение.
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Запустите сервер:
   ```bash
   uvicorn server:app --host 0.0.0.0 --port 8000
   ```
5. Откройте [http://localhost:8000](http://localhost:8000) в браузере и создайте комнату. После старта игры делитесь ссылкой с друзьями.

## Как играть

- Создатель вводит имя, выбирает размер комнаты и получает уникальную ссылку и код. Эти данные нужны всем участникам.
- В лобби видно, кто уже подключился и кто является ведущим. Только ведущий может нажать «Начать игру».
- Сервер раздаёт по 6 карт, объявляет козырь и автоматически находит первого атакующего (самый низкий козырь). Дальше игра идёт по классическим правилам «подкидного» дурака:
  - В ход участвуют атакующий, защитник и остальные игроки, которые могут подкидывать карты строго тех рангов, что уже есть на столе (ограничение по количеству — количество карт у защитника, максимум 6).
  - Защитник бьёт карты картами той же масти старше по рангу или козырями, а если не может — берёт всё со стола.
  - Если защитник отбился, он становится новым атакующим, а ход переходит дальше по кругу. Если взял — атакует прежний игрок.
  - После каждого раунда участники добирают карты до шести, начиная с текущего атакующего.
  - Когда в колоде карты заканчиваются и игрок избавился от руки, он выбывает. Последний с картами остаётся «дураком» и игра заканчивается.

## Структура проекта

- `server.py` – сервер FastAPI + игровая логика (управление комнатами, очередностью ходов, браузерным протоколом через WebSocket).
- `public/` – статический фронтенд (HTML/CSS/JS), который работает поверх WebSocket.
- `requirements.txt` – минимальные зависимости (FastAPI + Uvicorn).

## Что ещё можно улучшить

- Добавить сохранение состояний в БД, чтобы комнаты переживали рестарт сервера.
- Расширить UI вставками подсказок (подсветка валидных карт, история ходов).
- Сделать ботов, чтобы можно было тренироваться в одиночку.

## Доступ из интернета через Cloudflare Tunnel

Если вы хотите, чтобы друзья подключались не из локальной сети, поднимите туннель Cloudflare:

1. Установите утилиту [cloudflared](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/downloads/) и выполните `cloudflared login`, чтобы связать её со своей учётной записью, либо используйте «быстрый туннель» без авторизации.
2. Запустите зависимости приложения (`pip install -r requirements.txt`), затем выполните:
   ```bash
   python run_with_tunnel.py
   ```
   Скрипт одновременно стартует Uvicorn и вызывает `cloudflared tunnel --url http://localhost:8000`. В консоли появится публичный URL вида `https://*.trycloudflare.com`, которым можно делиться.
3. Если вы предпочитаете заранее созданный именованный туннель, задайте переменную `CLOUDFLARED_TUNNEL_TOKEN` (получить можно в Cloudflare Zero Trust → Access → Tunnels). Скрипт автоматически запустит `cloudflared tunnel run --token ...`.

> Замечание: `cloudflared` должен быть доступен в `PATH`. Скрипт не хранит никаких ключей — всё управление доступом остаётся на стороне Cloudflare.
